{"version":3,"sources":["js/Compositor.js","js/TileResolver.js","js/math.js","js/Entity.js","js/TileCollider.js","js/Level.js","js/SpriteSheet.js","js/anim.js","js/loaders.js","js/loaders/level.js","js/layers.js","js/traits/Go.js","js/traits/Jump.js","js/entities.js","js/Timer.js","js/KeyboardState.js","js/Camera.js","js/Canvas.js","js/entities_msg.js","js/input.js","js/Navbar.js","Portfolio.js","js/index.js","App.js","index.js"],"names":["Compositor","this","layers","context","camera","forEach","layer","TileResolver","matrix","tileSize","pos","Math","floor","pos1","pos2","pMax","ceil","range","push","toIndex","indexX","indexY","tile","get","x1","x2","y1","y2","posX","posY","getByIndex","matches","toIndexRange","match","Matrix","grid","callback","column","x","value","y","col","Vec2","set","Sides","TOP","Symbol","BOTTOM","Trait","name","NAME","console","warn","Entity","vel","size","traits","trait","side","obstruct","deltaTime","update","TileCollider","tileMatrix","tiles","entity","searchByRange","type","checkY","Level","gravity","totalTime","comp","entities","Set","tileCollider","checkX","test","SpriteSheet","image","width","height","Map","animation","buffers","map","flip","buffer","document","createElement","getContext","scale","translate","drawImage","define","distance","drawtile","draw","createAnim","frames","frameLen","frameIndex","length","loadJSON","url","fetch","then","r","json","loadSpriteSheet","sheetSpec","Promise","all","imageURL","resolve","Image","addEventListener","src","sprites","tileW","tileH","tileSpec","defineTile","index","frameSpec","rect","animations","animSpec","defineAnim","expandSpan","expandRanges","loadLevel","levelSpec","spriteSheet","level","collisionGrid","patterns","expandTiles","createCollisionGrid","reduce","mergedTiles","layerSpec","concat","setCollisionGrid","backgroundGrid","createBackgroundGrid","backgroundLayer","resolver","redraw","startIndex","endIndex","clearRect","has","drawAnim","drawWidth","drawFrom","createBackgroundLayer","spriteLayer","spriteBuffer","spriteBufferContext","createSpriteLayer","xStart","xLen","yStart","yLen","xEnd","yEnd","expandRange","ranges","item","f","expandedTiles","walkTiles","offsetX","offsetY","derivedX","derivedY","pattern","Go","dir","acceleration","deceleration","dragFactor","heading","absX","abs","jump","falling","decel","min","drag","Jump","ready","duration","velocity","engageTime","requestTime","gracePeriod","speedBoost","cancel","createMario","sprite","mario","addTrait","runAim","go","routeFrame","Timer","accumulatedTime","lastTime","updateProxy","time","enqueue","requestAnimationFrame","KeyboardState","keyStates","keyMap","code","event","preventDefault","keyState","window","eventName","handleEvent","Camera","Canvas","props","canvasRef","useRef","useEffect","canvas","current","log","text","text1","text2","text3","text4","text5","text6","text7","text8","text9","text10","text11","text12","add","input","addMapping","start","setupKeyboard","listenTo","timer","className","ref","Navbar","to","Portfolio","id","alt","href","target","Main","exact","path","App","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.5b95eb4d.chunk.js","sourcesContent":["export default class Compositor {\r\n\tconstructor(){\r\n\t\tthis.layers=[];\r\n\t}\r\n\r\n\tdraw(context,camera){\r\n\t\tthis.layers.forEach(layer=>{\r\n\t\t\tlayer(context,camera);\r\n\t\t});\r\n\t}\r\n}","export default class TileResolver{\r\n\tconstructor(matrix,tileSize=16){\r\n\t\tthis.matrix=matrix;\r\n\t\tthis.tileSize=tileSize;\r\n\t}\r\n\r\n\ttoIndex(pos){\r\n\t\treturn Math.floor(pos / this.tileSize);\r\n\t}\r\n\r\n\ttoIndexRange(pos1,pos2){\r\n\t\tconst pMax=Math.ceil(pos2/this.tileSize)*this.tileSize;\r\n\t\tconst range=[];\r\n\t\tlet pos = pos1;\r\n\t\tdo {\r\n\t\t\trange.push(this.toIndex(pos));\r\n\t\t\tpos+=this.tileSize;\r\n\t\t} while (pos<pMax);\r\n\t\treturn range;\r\n\t}\r\n\r\n\tgetByIndex(indexX,indexY){\r\n\t\tconst tile=this.matrix.get(indexX,indexY);\r\n\t\tif (tile){\r\n\t\t\tconst x1=indexX*this.tileSize;\r\n\t\t\tconst x2=x1+this.tileSize;\r\n\t\t\tconst y1=indexY*this.tileSize;\r\n\t\t\tconst y2=y1+this.tileSize;\r\n\t\t\treturn {\r\n\t\t\t\ttile,\r\n\t\t\t\tx1,\r\n\t\t\t\tx2,\r\n\t\t\t\ty1,\r\n\t\t\t\ty2,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByPosition(posX,posY){\r\n\t\treturn this.getByIndex(\r\n\t\t\tthis.toIndex(posX),\r\n\t\t\tthis.toIndex(posY));\r\n\t}\r\n\r\n\tsearchByRange(x1,x2,y1,y2){\r\n\t\tconst matches=[];\r\n\t\tthis.toIndexRange(x1,x2).forEach(indexX=>{\r\n\t\t\tthis.toIndexRange(y1,y2).forEach(indexY=>{\r\n\t\t\t\tconst match=this.getByIndex(indexX,indexY);\r\n\t\t\t\tif (match){\r\n\t\t\t\t\tmatches.push(match);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n}","export class Matrix{\r\n\tconstructor(){\r\n\t\tthis.grid=[];\r\n\t}\r\n\r\n\tforEach(callback){\r\n\t\tthis.grid.forEach((column,x)=>{\r\n \t\t\tcolumn.forEach((value,y)=>{\r\n \t\t\t\tcallback(value,x,y);\r\n \t\t\t});\r\n \t\t});\r\n\t}\r\n\r\n\tget(x,y){\r\n\t\tconst col = this.grid[x];\r\n\t\tif (col){\r\n\t\t\treturn col[y];\r\n\t\t}\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tset(x,y,value){\r\n\t\tif(!this.grid[x]){\r\n\t\t\tthis.grid[x]=[];\r\n\t\t}\r\n\t\tthis.grid[x][y]=value;\r\n\t}\r\n}\r\n\r\nexport class Vec2{\r\n\tconstructor(x,y){\r\n\t\tthis.set(x,y);\r\n}\r\n\t\tset(x,y){\r\n\t\tthis.x=x;\r\n\t\tthis.y=y;\r\n\t}\r\n}","import {Vec2} from './math.js';\r\n\r\nexport const Sides={\r\n\tTOP:Symbol('top'),\r\n\tBOTTOM:Symbol('bottom'),\r\n}\r\n\r\nexport class Trait{\r\n\tconstructor(name){\r\n\t\tthis.NAME=name;\r\n\t}\r\n\r\n\tobstruct(){\r\n\t\t\r\n\t}\r\n\r\n\tupdate(){\r\n\t\tconsole.warn('Unhandled update call in Trait')\r\n\t}\r\n}\r\n\r\nexport default class Entity{\r\n\tconstructor(){\r\n\t\tthis.pos=new Vec2(0,0);\r\n\t\tthis.vel=new Vec2(0,0);\r\n\t\tthis.size=new Vec2(0,0);\r\n\r\n\t\tthis.traits=[];\r\n\t}\r\n\r\n\taddTrait(trait){\r\n\t\tthis.traits.push(trait);\r\n\t\tthis[trait.NAME]=trait;\r\n\t}\r\n\r\n\tobstruct(side){\r\n\t\tthis.traits.forEach(trait=>{\r\n\t\t\ttrait.obstruct(this,side);\r\n\t\t});\r\n\t}\r\n\r\n\tupdate(deltaTime){\r\n\t\tthis.traits.forEach(trait=>{\r\n\t\t\ttrait.update(this,deltaTime);\r\n\t\t});\r\n\t}\r\n}","import TileResolver from './TileResolver.js';\r\nimport {Sides} from './Entity.js'\r\n\r\nexport default class TileCollider{\r\n\tconstructor(tileMatrix){\r\n\t\tthis.tiles=new TileResolver(tileMatrix);\r\n\t}\r\n\r\n\tcheckX(entity){\r\n\t\tlet x;\r\n\t\tif (entity.vel.x>0){\r\n\t\t\tx=entity.pos.x+entity.size.x;\r\n\t\t} else if (entity.vel.x<0){\r\n\t\t\tx=entity.pos.x;\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst matches=this.tiles.searchByRange(\r\n\t\t\tentity.pos.x,entity.pos.x+entity.size.x,\r\n\t\t\tentity.pos.y,entity.pos.y+entity.size.y);\r\n\r\n\t\tmatches.forEach(match=>{\r\n\t\t\tif (match.tile.type!=='ground'){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (entity.vel.x>0){\r\n\t\t\t\tif (entity.pos.x+entity.size.x>(match.x1)){\r\n\t\t\t\t\tentity.pos.x=(match.x1-entity.size.x);\r\n\t\t\t\t\tentity.vel.x=0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (entity.vel.x<0){\r\n\t\t\t\tif (entity.pos.x<(match.x2)){\r\n\t\t\t\t\tentity.pos.x=(match.x2);\r\n\t\t\t\t\tentity.vel.x=0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcheckY(entity){\r\n\t\tlet y;\r\n\t\tif (entity.vel.y>0){\r\n\t\t\ty=entity.pos.y+entity.size.y;\r\n\t\t} else if (entity.vel.y<0){\r\n\t\t\ty=entity.pos.y\r\n\t\t\t;\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst matches=this.tiles.searchByRange(\r\n\t\t\tentity.pos.x,entity.pos.x+entity.size.x,\r\n\t\t\tentity.pos.y,entity.pos.y+entity.size.y);\r\n\r\n\t\tmatches.forEach(match=>{\r\n\t\t\tif (match.tile.type!=='ground'){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (entity.vel.y>0){\r\n\t\t\t\tif (entity.pos.y+entity.size.y>(match.y1)){\r\n\t\t\t\t\tentity.pos.y=(match.y1-entity.size.y);\r\n\t\t\t\t\tentity.vel.y=0;\r\n\r\n\t\t\t\t\tentity.obstruct(Sides.BOTTOM);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (entity.vel.y<0){\r\n\t\t\t\tif (entity.pos.y<(match.y2)){\r\n\t\t\t\t\tentity.pos.y=(match.y2);\r\n\t\t\t\t\tentity.vel.y=0;\r\n\r\n\t\t\t\t\tentity.obstruct(Sides.TOP);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\ttest(entity){\r\n\t\tthis.checkY(entity);\r\n\t\t//const match=this.tiles.matchByPosition(entity.pos.x,entity.pos.y);\r\n\t\t//if (match){\r\n\t\t//console.log('Matched tile',match,match.tile);\r\n\t\t}\r\n}","import Compositor from './Compositor.js';\r\nimport TileCollider from './TileCollider.js';\r\n\r\nexport default class Level{\r\n\tconstructor(){\r\n\t\tthis.gravity=1000;\r\n\t\tthis.totalTime=0;\r\n\t\tthis.comp=new Compositor();\r\n\t\tthis.entities=new Set();\r\n\r\n\t\tthis.tileCollider=null;\r\n\t}\r\n\r\n\tsetCollisionGrid(matrix){\r\n\t\tthis.tileCollider=new TileCollider(matrix);\r\n\t}\r\n\tupdate(deltaTime){\r\n\t\tthis.entities.forEach(entity=>{\r\n\t\t\tentity.update(deltaTime);\r\n\r\n\t\t\tentity.pos.x+=entity.vel.x*deltaTime;\r\n\t\t\tthis.tileCollider.checkX(entity);\r\n\r\n\t\t\tentity.pos.y+=entity.vel.y*deltaTime;\r\n\t\t\tthis.tileCollider.checkY(entity);\r\n\r\n\t\t\tentity.vel.y +=this.gravity*deltaTime;\r\n\r\n\t\t\tthis.tileCollider.test(entity); //not inside video\r\n\t\t});\r\n\r\n\t\tthis.totalTime+=deltaTime;\r\n\t}\r\n}","export default class SpriteSheet{\r\n\tconstructor(image,width,height){\r\n\t\tthis.image=image;\r\n\t\tthis.width=width;\r\n\t\tthis.height=height;\r\n\t\tthis.tiles=new Map();\r\n\t\tthis.animation=new Map();\r\n\t}\r\n\r\n\tdefineAnim(name,animation){\r\n\t\tthis.animation.set(name,animation);\r\n\t}\r\n\r\n\tdefine(name,x,y,width,height){\r\n\t\tconst buffers = [false,true].map(flip=>{\r\n\t\tconst buffer=document.createElement('canvas');\r\n\t\tbuffer.width=width; //?\r\n\t\tbuffer.height=height; //?\r\n\r\n\t\tconst context =buffer.getContext('2d');\r\n\r\n\t\tif (flip){\r\n\t\tcontext.scale(-1,1);\r\n\t\tcontext.translate(-width,0);\r\n\t\t}\r\n\r\n\t\tcontext.drawImage(\r\n\t\t\t\tthis.image,\r\n\t\t\t\tx, //pieces\r\n\t\t\t\ty,\r\n\t\t\t\twidth,\r\n\t\t\t\theight,\r\n\t\t\t\t0, //coordinates\r\n\t\t\t\t0,\r\n\t\t\t\twidth, //size\r\n\t\t\t\theight);\r\n\t\t\treturn buffer;\r\n\t\t});\r\n\t\tthis.tiles.set(name,buffers);\r\n\t}\r\n\r\n\tdefineTile(name,x,y){\r\n\t\tthis.define(name,x*this.width,y*this.height,this.width,this.height);\r\n\t}\r\n\r\n\tdraw(name,context,x,y, flip=false){\r\n\t\tconst buffer=this.tiles.get(name)[flip?1:0];\r\n\t\tcontext.drawImage(buffer,x,y);\r\n\t}\r\n\r\n\tdrawAnim(name,context,x,y,distance){\r\n\t\tconst animation = this.animation.get(name);\r\n\t\tthis.drawtile(animation(distance),context,x,y);\r\n\t}\r\n\r\n\tdrawtile(name,context,x,y){\r\n\t\tthis.draw(name,context,x*this.width,y*this.height);\r\n\t}\r\n}","export function createAnim(frames,frameLen){\r\n\treturn function resolveFrame(distance){\r\n\t\tconst frameIndex=Math.floor(distance/frameLen)%frames.length;\r\n\t\tconst frameName=frames[frameIndex];\r\n\t\treturn frameName;\r\n\t}\r\n}","import SpriteSheet from './SpriteSheet.js';\r\nimport {createAnim} from './anim.js';\r\n\r\nexport function loadImage(url) {\r\n\treturn new Promise(resolve => {\r\n\t\tconst image = new Image();\r\n\t\timage.addEventListener('load', () => {\r\n\t\t\tresolve(image);\r\n\t\t});\r\n\t\timage.src = url;\r\n\t});\r\n}\r\n\r\nexport function loadJSON(url){\r\n\treturn fetch(url)\r\n\t.then(r=>r.json());\r\n}\r\n\r\nexport function loadSpriteSheet(name){\r\n\treturn loadJSON(`./sprites/${name}.json`)\r\n\t.then(sheetSpec=> Promise.all([\r\n\t\tsheetSpec,\r\n\t\tloadImage(sheetSpec.imageURL),\r\n\t]))\r\n\t.then(([sheetSpec,image])=>{\r\n\t\tconst sprites=new SpriteSheet(\r\n\t\timage,\r\n\t\tsheetSpec.tileW,\r\n\t\tsheetSpec.tileH); //size\r\n\r\n\t\tif (sheetSpec.tiles){\r\n\t\t\tsheetSpec.tiles.forEach(tileSpec=>{\r\n\t\t\t\tsprites.defineTile(\r\n\t\t\t\t\ttileSpec.name,\r\n\t\t\t\t\ttileSpec.index[0],\r\n\t\t\t\t\ttileSpec.index[1]);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (sheetSpec.frames){\r\n\t\t\tsheetSpec.frames.forEach(frameSpec=>{\r\n\t\t\t\tsprites.define(frameSpec.name, ...frameSpec.rect);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (sheetSpec.animations){\r\n\t\t\tsheetSpec.animations.forEach(animSpec=>{\r\n\t\t\t\tconst animation=createAnim(animSpec.frames,animSpec.frameLen);\r\n\t\t\t\tsprites.defineAnim(animSpec.name,animation);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn sprites;\r\n\t});\r\n}\r\n\r\n","import Level from '../Level.js';\r\nimport {createBackgroundLayer, createSpriteLayer} from '../layers.js';\r\nimport {loadJSON, loadSpriteSheet} from '../loaders.js';\r\nimport {Matrix} from '../math.js';\r\n\r\nexport function loadLevel(name){\r\n\treturn loadJSON(`./levels/${name}.json`)\r\n\t.then(levelSpec => Promise.all([\r\n\t\tlevelSpec,\r\n\t\tloadSpriteSheet(levelSpec.spriteSheet),\r\n\t]))\r\n\t.then(([levelSpec,sprites])=>{\r\n\t\tconst level = new Level();\r\n\r\n\t\tconst mergedTiles=levelSpec.layers.reduce((mergedTiles,layerSpec)=>{\r\n\t\t\treturn mergedTiles.concat(layerSpec.tiles);\r\n\t\t}, []);\r\n\t\tconst collisionGrid=createCollisionGrid(mergedTiles,levelSpec.patterns)\r\n\t\tlevel.setCollisionGrid(collisionGrid);\r\n\r\n\t\tlevelSpec.layers.forEach(layer=>{\r\n\t\tconst backgroundGrid=createBackgroundGrid(layer.tiles,levelSpec.patterns)\r\n \t\tconst backgroundLayer=createBackgroundLayer(level,backgroundGrid, sprites);\r\n \t\tlevel.comp.layers.push(backgroundLayer);\r\n \t\t});\r\n\r\n \t\tconst spriteLayer=createSpriteLayer(level.entities);\r\n \t\tlevel.comp.layers.push(spriteLayer);\r\n\r\n \t\treturn level;\r\n\t})\r\n}\r\n\r\nfunction createCollisionGrid(tiles,patterns){\r\n\tconst grid=new Matrix();\r\n\r\n\tfor (const {tile,x,y} of expandTiles(tiles,patterns)){\r\n\t\t\tgrid.set(x,y,{type:tile.type});\r\n\t\t}\r\n\r\n\t\treturn grid;\r\n}\r\n\r\nfunction createBackgroundGrid(tiles,patterns){\r\n\tconst grid=new Matrix();\r\n\r\n\tfor (const {tile,x,y} of expandTiles(tiles,patterns)){\r\n\t\t\tgrid.set(x,y,{name:tile.name});\r\n\t\t}\r\n\r\n\t\treturn grid;\r\n}\r\n\r\nfunction* expandSpan(xStart,xLen,yStart,yLen){\r\n\tconst xEnd=xStart+xLen;\r\n\tconst yEnd=yStart+yLen;\r\n\tfor (let x=xStart;x<xEnd;++x){\r\n\t\tfor (let y=yStart;y<yEnd;++y){\r\n\t\t\tyield {x,y};\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction expandRange(range){\r\n\tif (range.length===4){\r\n\t\tconst [xStart,xLen,yStart,yLen]=range;\r\n\t\treturn expandSpan(xStart,xLen,yStart,yLen);\r\n\t}\r\n\r\n\telse if (range.length===3){\r\n\t\tconst [xStart,xLen,yStart]=range;\r\n\t\treturn expandSpan(xStart,xLen,yStart,1);\r\n\t}\r\n\r\n\telse if (range.length===2){\r\n\t\tconst [xStart,yStart]=range;\r\n\t\treturn expandSpan(xStart,1,yStart,1);\r\n\t}\r\n}\r\n\r\nfunction* expandRanges(ranges){\r\n\tfor (const range of ranges){\r\n\t\tfor (const item of expandRange(range)){\r\n\t\t\tyield item;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction expandTiles(tiles,patterns){\r\n\tconst expandedTiles =[];\r\n\r\n\tfunction walkTiles(tiles,offsetX,offsetY){\r\n\t\tfor (const tile of tiles){\r\n\t\t\tfor (const {x,y} of expandRanges(tile.ranges)){\r\n\t\t\t\tconst derivedX=x+offsetX;\r\n\t\t\t\tconst derivedY=y+offsetY;\r\n\r\n\t\t\t\tif (tile.pattern){\r\n\t\t\t\t\t\tconst tiles=patterns[tile.pattern].tiles;\r\n\t\t\t\t\t\twalkTiles(tiles,derivedX,derivedY);\r\n\t\t\t\t\t} else{\r\n\t\t\t\t\t\texpandedTiles.push({\r\n\t\t\t\t\t\t\ttile,\r\n\t\t\t\t\t\t\tx:derivedX,\r\n\t\t\t\t\t\t\ty:derivedY,\r\n\t\t\t\t\t\t}); \r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\twalkTiles(tiles,0,0);\r\n\r\n\treturn expandedTiles;\r\n}\r\n","import TileResolver from './TileResolver.js';\r\n\r\nexport function createBackgroundLayer (level,tiles, sprites){\r\n\tconst resolver = new TileResolver(tiles);\r\n\r\n\tconst buffer=document.createElement('canvas');\r\n \tbuffer.width=550;\r\n \tbuffer.height=640;\r\n \tconst context=buffer.getContext('2d');\r\n\r\n \tfunction redraw(startIndex,endIndex){\r\n \t\tcontext.clearRect(0,0,buffer.width,buffer.height);\r\n \t\tfor (let x=startIndex;x<=endIndex;++x){\r\n \t\t\tconst col = tiles.grid[x];\r\n \t\t\tif (col){\r\n \t\t\t\tcol.forEach((tile,y)=>{\r\n \t\t\t\t\tif (sprites.animation.has(tile.name)){\r\n \t\t\t\t\t\tsprites.drawAnim(tile.name,context,x-startIndex,y,level.totalTime);\r\n \t\t\t\t\t} else {\r\n \t\t\t\t\t\tsprites.drawtile(tile.name,context,x-startIndex,y);\r\n \t\t\t\t\t}\r\n \t\t\t\t});\r\n \t\t\t}\r\n \t\t}\r\n \t}\r\n\r\n \treturn function drawBackgroundLayer(context,camera){\r\n \t\tconst drawWidth=resolver.toIndex(camera.size.x);\r\n \t\tconst drawFrom=resolver.toIndex(camera.pos.x);\r\n \t\tconst drawTo=drawFrom+drawWidth;\r\n \t\tredraw(drawFrom,drawTo);  //+screenwidth here\r\n \t\tcontext.drawImage(buffer,\r\n \t\t\t-camera.pos.x%16,\r\n \t\t\t-camera.pos.y);\r\n \t};\r\n}\r\n\r\nexport function createSpriteLayer(entities, width=200,height=64){\r\n\tconst spriteBuffer=document.createElement('canvas');\r\n\tspriteBuffer.width=width;\r\n\tspriteBuffer.height=height;\r\n\tconst spriteBufferContext=spriteBuffer.getContext('2d');\r\n\r\n\treturn function drawSpriteLayer(context,camera){\r\n\t\tentities.forEach(entity=>{\r\n\t\t\tspriteBufferContext.clearRect(0,0,width,height);\r\n\r\n\t\t\tentity.draw(spriteBufferContext);\r\n\r\n\t\t\tcontext.drawImage(\r\n\t\t\t\tspriteBuffer,\r\n\t\t\t\tentity.pos.x-camera.pos.x,  //here\r\n\t\t\t\tentity.pos.y-camera.pos.y); //here\r\n\t\t});\r\n\t};\r\n}\r\n\r\n// export function createCollisionLayer(level){\r\n// \tconst resolvedTiles=[];\r\n\r\n// \tconst tileResolver=level.tileCollider.tiles;\r\n// \tconst tileSize=tileResolver.tileSize;\r\n\r\n// \tconst getByIndexOriginal=tileResolver.getByIndex;\r\n// \ttileResolver.getByIndex=function getByIndexFake(x,y){\r\n// \t\tresolvedTiles.push({x,y});\r\n// \t\treturn getByIndexOriginal.call(tileResolver,x,y);\r\n// \t}\r\n\r\n// \treturn function drawCollision(context){\r\n// \t\tcontext.strokeStyle='blue';\r\n// \t\tresolvedTiles.forEach(({x,y})=>{\r\n// \t\t\tcontext.beginPath();\r\n// \t\t\tcontext.rect(\r\n// \t\t\t\tx*tileSize-camera.pos.x, //here\r\n// \t\t\t\ty*tileSize-camera.pos.y, //here\r\n// \t\t\t\ttileSize,tileSize);\r\n// \t\t\t//context.stroke();\r\n// \t\t\t//console.log('Would draw',x,y);\r\n// \t\t});\r\n\r\n// \t\tcontext.strokeStyle='red';\r\n// \t\tlevel.entities.forEach(entity=>{\r\n// \t\t\tcontext.beginPath();\r\n// \t\t\tcontext.rect(\r\n// \t\t\t\tentity.pos.x-camera.pos.x, //here\r\n// \t\t\t\tentity.pos.y-camera.pos.y, //here\r\n// \t\t\t\tentity.size.x,\r\n// \t\t\t\tentity.size.y);\r\n// \t\t\t//context.stroke();\r\n// \t\t})\r\n\r\n// \t\tresolvedTiles.length=0;\r\n// \t};\r\n// }\r\n\r\nexport function createCameraLayer(cameraToDraw){\r\n\treturn function drawCameraRect(context,fromCamera){\r\n\t\tcontext.strokeStyle='purple';\r\n\t\tcontext.beginPath();\r\n\t\t\tcontext.rect(\r\n\t\t\t\tcameraToDraw.pos.x-fromCamera.pos.x,\r\n\t\t\t\tcameraToDraw.pos.y-fromCamera.pos.y,\r\n\t\t\t\tcameraToDraw.size.x,\r\n\t\t\t\tcameraToDraw.size.y);\r\n\t\t\tcontext.stroke();\r\n\t};\r\n}","import {Trait} from '../Entity.js';\r\n\r\nexport default class Go extends Trait{\r\n\tconstructor(){\r\n\t\tsuper('go');\r\n\r\n\t\tthis.dir=0;\r\n\t\tthis.acceleration=400;\r\n\t\tthis.deceleration=300;\r\n\t\tthis.dragFactor=1/5000;\r\n\r\n\t\tthis.distance =0;\r\n\t\tthis.heading=1;\r\n\t}\r\n\r\n\tupdate(entity,deltaTime){\r\n\t\tconst absX=Math.abs(entity.vel.x);\r\n\t\tif (this.dir!==0){\r\n\t\t\tentity.vel.x+=this.acceleration*this.dir*deltaTime;\r\n\r\n\t\t\tif (entity.jump){\r\n\t\t\t\tif (entity.jump.falling===false){\r\n\t\t\t\t\tthis.heading=this.dir;\r\n\t\t\t\t}\r\n\t\t\t}else {\r\n\t\t\tthis.heading=this.dir;\r\n\t\t\t}\r\n\t\t} else if (entity.vel.x!==0){\r\n\t\t\tconst decel=Math.min(absX,this.deceleration*deltaTime);\r\n\t\t\tentity.vel.x+=entity.vel.x>0 ? -decel:decel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.distance=0;\r\n\t\t}\r\n\r\n\t\tconst drag=this.dragFactor*entity.vel.x*absX;\r\n\t\tentity.vel.x-=drag;\r\n\r\n\t\tthis.distance+=absX*(deltaTime);\r\n\t}\r\n}","import {Sides,Trait} from '../Entity.js';\r\n\r\nexport default class Jump extends Trait{\r\n\tconstructor(){\r\n\t\tsuper('jump');\r\n\r\n\t\tthis.ready=0;\r\n\t\tthis.duration=0.5;\r\n\t\tthis.velocity=200;\r\n\t\tthis.engageTime=0;\r\n\t\tthis.requestTime=0;\r\n\t\tthis.gracePeriod=0.1;\r\n\t\tthis.speedBoost=0.1;\r\n\t}\r\n\r\n\tget falling(){\r\n\t\treturn this.ready <0;\r\n\t}\r\n\r\n\tstart(){\r\n\t\tthis.requestTime=this.gracePeriod;\r\n\t}\r\n\r\n\tcancel(){\r\n\t\tthis.engageTime=0;\r\n\t\tthis.requestTime=0;\r\n\t}\r\n\r\n\tobstruct(entity, side){\r\n\t\tif (side===Sides.BOTTOM){\r\n\t\t\tthis.ready=1;\r\n\t\t} else if (side===Sides.TOP){\r\n\t\t\tthis.cancel();\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(entity,deltaTime){\r\n\t\tif (this.requestTime>0){\r\n\t\t\tif (this.ready>0){\r\n\t\t\t\tthis.engageTime=0.3;\r\n\t\t\t\tthis.requestTime=0;\r\n\t\t\t}\r\n\r\n\t\t\tthis.requestTime-=deltaTime;\r\n\t\t}\r\n\t\tif (this.engageTime>0){\r\n\t\t\tentity.vel.y=-this.velocity+Math.abs(entity.vel.x)*this.speedBoost;\r\n\t\t\tthis.engageTime-=deltaTime;\r\n\t\t}\r\n\r\n\t\tthis.ready--;\r\n\t}\r\n}","import Entity from './Entity.js';\r\nimport Go from './traits/Go.js';\r\nimport Jump from './traits/Jump.js';\r\nimport {loadSpriteSheet} from './loaders.js';\r\nimport {createAnim} from './anim.js';\r\n\r\nexport function createMario(){\r\n\treturn loadSpriteSheet('mario')\r\n\t.then(sprite=>{\r\n\t\tconst mario = new Entity();\r\n\t\tmario.size.set(50,50);\r\n\t\t\r\n\t\tmario.addTrait(new Go());\r\n\t\tmario.addTrait(new Jump());\r\n\r\n\t\tconst runAim=createAnim(['run-1','run-2'],15);\r\n\r\n\t\tfunction routeFrame(mario){\r\n\t\t\tif (mario.jump.falling){\r\n\t\t\t\treturn 'jump';\r\n\t\t\t}\r\n\t\t\tif (mario.go.dir!==0){\r\n\t\t\t\tif ((mario.vel.x>0&&mario.go.dir<0)||(mario.vel.x<0&&mario.go.dir>0)){\r\n\t\t\t\t\treturn 'break';\r\n\t\t\t\t}\r\n\t\t\t\treturn runAim(mario.go.distance);\r\n\t\t\t}\r\n\t\t\treturn 'player';\r\n\t\t}\r\n\r\n\t\tmario.draw=function drawMario(context){\r\n\t\t\tsprite.draw(routeFrame(mario),context,0,0,this.go.heading<0);\r\n\t\t}\r\n\r\n\t\treturn mario;\r\n\t});\r\n}","export default class Timer{\r\n\tconstructor (deltaTime=1/60){\r\n\tlet accumulatedTime=0;\r\n\tlet lastTime=0;\r\n\r\n \tthis.updateProxy = (time)=>{\r\n \taccumulatedTime+=(time-lastTime)/1000;\r\n\r\n \tif (accumulatedTime >1){\r\n \t\taccumulatedTime=1;\r\n \t}\r\n\r\n \twhile (accumulatedTime > deltaTime){\r\n \tthis.update(deltaTime);\r\n \taccumulatedTime-=deltaTime;\r\n \t\t\t}\r\n \tlastTime=time;\r\n \tthis.enqueue();\r\n \t\t}\r\n\t}\r\n\r\n\tenqueue(){\r\n\t\trequestAnimationFrame(this.updateProxy);\r\n\t}\r\n\r\n\tstart(){\r\n\t\tthis.enqueue();\r\n\t}\r\n}","const PRESSED =1;\r\nconst RELEASED =0;\r\n\r\nexport default class KeyboardState{\r\n\tconstructor(){\r\n\t\t// Holds the current state of a given key\r\n\t\tthis.keyStates=new Map();\r\n\r\n\t\t// Holds the callback functions for a key code\r\n\t\tthis.keyMap=new Map();\r\n\t}\r\n\r\n\taddMapping(code, callback){\r\n\t\tthis.keyMap.set(code,callback);\r\n\t}\r\n\r\n\thandleEvent(event){\r\n\t\tconst {code}=event;\r\n\r\n\t\tif (!this.keyMap.has(code)){\r\n\t\t\t// Did not have key mapped.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tconst keyState=event.type ==='keydown' ? PRESSED : RELEASED;\r\n\r\n\t\tif (this.keyStates.get(code) === keyState){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.keyStates.set(code, keyState);\r\n\t\t//console.log(this.keyStates);\r\n\t\tthis.keyMap.get(code)(keyState);\r\n\t}\r\n\r\n\tlistenTo(window){\r\n\t\t['keydown','keyup'].forEach(eventName=>{\r\n\t\t\twindow.addEventListener(eventName,event=>{\r\n\t\t\t\tthis.handleEvent(event);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}","import {Vec2} from './math.js';\r\n\r\nexport default class Camera {\r\n\tconstructor(){\r\n\t\tthis.pos=new Vec2(0,0);\r\n\t\t//this.size=new Vec2(256,224);\r\n\t\tthis.size=new Vec2(500,320);\r\n\t}\r\n}","import React, { useRef, useEffect } from 'react';\r\nimport {loadLevel} from './loaders/level.js';\r\nimport {createMario} from './entities.js';\r\nimport Timer from './Timer.js';\r\nimport {setupKeyboard} from './input.js';\r\nimport Camera from './Camera.js';\r\nimport './canvas.scss';\r\nimport * as msg from './entities_msg.js';\r\n\r\nconst Canvas = (props) => {\r\n  const canvasRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const canvas = canvasRef.current;\r\n    console.log(canvas);\r\n    const context = canvas.getContext('2d');\r\n    context.canvas.width=500;\r\n    context.canvas.height=320;\r\n    \r\n    Promise.all([\r\n      createMario(),\r\n      loadLevel('1-1'),\r\n      msg.createTxt1(),\r\n      msg.createTxt2(),\r\n      msg.createTxt3(),\r\n      msg.createTxt4(),\r\n      msg.createTxt5(),\r\n      msg.createTxt6(),\r\n      msg.createTxt7(),\r\n      msg.createTxt8(),\r\n      msg.createTxt9(),\r\n      msg.createTxt10(),\r\n      msg.createTxt11(),\r\n      msg.createTxt12(),\r\n    ])\r\n    .then(([mario,level,text1,text2,text3,text4,text5,text6,text7,text8,text9,text10,text11,text12])=>{\r\n      const camera = new Camera();\r\n      window.camera=camera;\r\n   \r\n      mario.pos.set(50,90);\r\n      text1.pos.set(50,90);\r\n      text2.pos.set(50,90);\r\n      text3.pos.set(500,80);\r\n      text4.pos.set(500,80);\r\n      text5.pos.set(720,80);\r\n      text6.pos.set(880,40);\r\n      text7.pos.set(1280,80);\r\n      text8.pos.set(1280,80);\r\n      text9.pos.set(1800,80);\r\n      text10.pos.set(2200,80);\r\n      text11.pos.set(2200,80);\r\n      text12.pos.set(2600,80);\r\n   \r\n      level.entities.add(mario);\r\n      level.entities.add(text1);\r\n      level.entities.add(text2);\r\n      level.entities.add(text3);\r\n      level.entities.add(text4);\r\n      level.entities.add(text5);\r\n      level.entities.add(text6);\r\n      level.entities.add(text7);\r\n      level.entities.add(text8);\r\n      level.entities.add(text9);\r\n      level.entities.add(text10);\r\n      level.entities.add(text11);\r\n      level.entities.add(text12);\r\n\r\n      const input=setupKeyboard(mario);\r\n      input.listenTo(window);\r\n   \r\n      const timer= new Timer(1/60);\r\n   \r\n      timer.update =function update(deltaTime){\r\n      level.comp.draw(context,camera);\r\n      level.update(deltaTime);\r\n      if (mario.pos.x>100){\r\n        camera.pos.x=mario.pos.x-100\r\n      }\r\n    }\r\n      timer.start();\r\n    });\r\n  },[])\r\n  \r\n  return(\r\n    <>\r\n    <canvas className=\"canvas\" ref={canvasRef} {...props}/>\r\n    <h2 className=\"guide\">Arrow key left & right to move! Space to jump!</h2>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Canvas","import Entity from './Entity.js';\r\nimport {loadSpriteSheet} from './loaders.js';\r\n\r\nexport function createTxt1(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,100);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text1',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n};\r\n\r\nexport function createTxt2(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,70);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text2',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n};\r\n\r\nexport function createTxt3(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,80);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text3',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt4(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,55);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text4',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt5(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(0,20);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text5',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt6(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(150,20);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text6',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt7(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,150);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text7',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt8(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,90);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text8',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt9(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,150);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text9',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt10(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,150);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text10',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt11(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,100);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text11',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}\r\n\r\nexport function createTxt12(){\r\n\treturn loadSpriteSheet('text')\r\n\t.then(sprite=>{\r\n\t\tconst text = new Entity();\r\n\t\ttext.size.set(200,150);\r\n        text.draw=function drawMsg(context){\r\n\t\t\tsprite.draw('text12',context,0,0);\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t});\r\n}","import KeyboardState from './KeyboardState.js';\r\n\r\nexport function setupKeyboard(entity){\r\n \tconst input =new KeyboardState();\r\n\tinput.addMapping('Space', keyState=>{\r\n\t\tif (keyState){\r\n\t\t\tentity.jump.start();\r\n\t\t} \r\n\t\telse{\r\n\t\t\tentity.jump.cancel();\r\n\t\t}\r\n\t});\r\n\tinput.addMapping('ArrowRight', keyState=>{\r\n\t\tentity.go.dir+=keyState?1:-1;\r\n\t});\r\n\tinput.addMapping('ArrowLeft', keyState=>{\r\n\t\tentity.go.dir+=keyState?-1:1;\r\n\t});\r\n\r\n\treturn input;\r\n}","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './canvas.scss';\r\n\r\nexport default function Navbar() {\r\n  return (\r\n  <>\r\n    <ul>\r\n      <Link to=\"/portfolio\" className=\"portfolio\"><span>Check</span> <span>out</span> <span>my</span> <span>projects</span> <span>here!</span></Link>\r\n    </ul>\r\n  </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport './portfolio.scss';\r\n\r\nconst Portfolio = () =>{\r\n    return (\r\n        <>\r\n        <div id=\"title\" className=\"slide header\">\r\n            <img id=\"profilepic\" src='/img/me.jpg' alt=\"Cannot view? Oh you just missed my handsome face\"></img>\r\n            <h1>Kai Yang</h1>\r\n            <div className=\"table center\">\r\n            <div className=\"monitor-wrapper center\">\r\n              <div className=\"monitor center\">\r\n                <p className=\"text1 center\">Data Enthusiast | Problem Solver | JavaScript Lover</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div id=\"slide1\" className=\"slide\">\r\n            <div className=\"title\">\r\n                <h1>VFT Reader with Machine Learning</h1>\r\n                <p>Singapore Eye Research Institute (SERI) processes thousands of <a href=\"/img/VFTReport.TIF\">VFT Reports</a> everyday. It is crucial to automate the data extraction process. The VFT Reader consists of two main parts:</p>\r\n                <li>pytesseract for paragraph recognition</li>\r\n                <li>Convolutional Neural Network (CNN) for axis graph reading</li>\r\n                <p>The Convolutional Neural Network has been trained with over 200,000 digits and symbols data, and is able to achieve 99.58% accuracy.</p>\r\n                <p>Visit this <a href=\"https://github.com/kaiyang7766/VFTReader\" target=\"_blank\">link</a> to read the full strategies and documentations!</p>\r\n            </div>\r\n            <img id=\"projectpic\" src=\"/img/SERI_logo.JPEG\"/>\r\n            \r\n            {/* <img id=\"projectpic\" src=\"https://lorempixel.com/640/480/abstract/4/\"/> */}\r\n        </div>\r\n\r\n        <div id=\"slide2\" className=\"slide\">\r\n            <div className=\"title\">\r\n                <h1>Underground Mobility Sensing Project using multi-sensory data with Machine Learning</h1>\r\n                <p>Location information about commuter activities is vital for planning for travel disruptions and infrastructural development. However, GPS connectivity is lost when underground in our MRT networks.\r\n                The Mobility Sensing Project aims to find innovative and novel ways to conduct location sensing using multi-sensory data collected in smartphones.</p>\r\n                <p>Visit this <a href=\"https://github.com/kaiyang7766/UndergroundMobilitySensing\" target=\"_blank\">link</a> to find out more!</p>\r\n                <p></p>\r\n                <img id=\"projectpic\" src=\"/img/LTA_logo.png\"/>\r\n            </div>\r\n        </div>\r\n\r\n        <div id=\"slide3\" className=\"slide\">\r\n            <div className=\"title\">\r\n                <h1>Breadtalk Traceability Online System</h1>\r\n                <p>Food Traceability System has always been a core in Food Safety measurements. In order to facilitate efficient tracking of raw materials back in my internship at BreadTalk, I created an online system using React.js for the production team to record down the daily usage of materials on the comfort of their phones.</p>\r\n                <p><a href=\"https://github.com/kaiyang7766/breadtalkmockapp\" target=\"_blank\">Github code repository</a></p>\r\n                <p><a href=\"https://focused-ardinghelli-c3b960.netlify.app/\" target=\"_blank\">Mock application interface (Only Traceability System is working)</a></p>\r\n            </div>\r\n            <img id=\"projectpic\" src=\"/img/Breadtalk_logo.jpg\"/>\r\n        </div>\r\n\r\n        <div id=\"slide4\" className=\"slide header\">\r\n            <h1>Connect with me!</h1>\r\n            <a href=\"https://github.com/kaiyang7766\" target=\"_blank\">\r\n                <img id=\"connectpic\" src=\"/img/Github_logo_white.png\"/>\r\n            </a>\r\n            <a href=\"https://www.linkedin.com/in/ang-kai-yang/\" target=\"_blank\">\r\n                <img id=\"connectpic\" src=\"/img/LinkedIn_logo_white.png\"/>\r\n            </a>\r\n        </div>\r\n        </>\r\n    )\r\n};\r\n\r\nexport default Portfolio;","import React, { useRef, useEffect } from 'react';\r\nimport { BrowserRouter as Router, Route1, Switch } from 'react-router-dom';\r\nimport { HashRouter, Route, Link } from \"react-router-dom\";\r\nimport Canvas from './Canvas.js';\r\nimport Navbar from './Navbar.js';\r\nimport Portfolio from '../Portfolio.js';\r\nimport '../portfolio.scss';\r\n\r\nconst Main = () => {\r\n  return(\r\n    <>\r\n    <HashRouter>\r\n      <Switch>\r\n        <Route exact path=\"/\">\r\n          <Canvas/>\r\n          <Navbar/>\r\n        </Route>\r\n        <Route exact path=\"/portfolio\">\r\n          <Portfolio/>\r\n        </Route>\r\n      </Switch>\r\n    </HashRouter>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Main","import Main from './js';\n\nfunction App() {\n  return(\n    <>\n    <Main/>\n    </>\n  )\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}